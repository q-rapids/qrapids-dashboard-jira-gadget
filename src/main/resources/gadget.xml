<?xml version="1.0" encoding="UTF-8" ?>
<Module>

    <!-- title_url="http://groups.google.com/group/Google-Gadgets-API" -->
    <ModulePrefs title="__MSG_gadget.title__"
                 directory_title="__MSG_gadget.title__"
                 description="__MSG_gadget.description__"
                 author="Mora Macías Germán Eduardo"
                 author_email="german.eduardo.mora@est.fib.upc.edu"
                 screenshot="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/images/qrapids_logo.png"
                 thumbnail="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/images/qrapids_logo.png">

        <!-- El elemento indica al container que el gadget puede utilizar una función específica -->
        <Optional feature="gadget-directory">
            <!-- Permite suministrar parametros para las funciones solicitadas a traves de los elementos -->
            <Param name="categories">
                JIRA
                Charts
                QRapids
            </Param>
        </Optional>
        <Optional feature="atlassian.util" />
        <Optional feature="auth-refresh" />

        <!-- El elemento indica al container que el gadget necesita un caracteristica especifica (librerias) -->
        <Require feature="views" />
        <Require feature="settitle"/>
        <Require feature="oauthpopup" />
        <Require feature="opensocial-0.8" />
        <Require feature="dynamic-height"/>
        <Require feature="minimessage"/>
        <Require feature="setprefs" />

        #oauth
        <Locale messages="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/i18n/ALL_ALL.xml"/>
    </ModulePrefs>

    <!--
        This section allows users a way to provide their preferences "user preferences".
        These user input fields are converted into user interface controls when the gadget is run.
        When the gadget is displayed on iGoogle, you can access the user's preferences from the "Edit" drop-down menu.

        The container handles the generation of the configuration UI, saves the configuration and provides an API to access the configuration in JavaScript.
    -->

    <UserPref name="isConfigured" datatype="hidden" default_value="false" />
    <UserPref name="urlDashboardApiCallsPref" datatype="hidden"/>
    <UserPref name="selectProjectUserPref" datatype="hidden" />


    <!--
        In this section, you will define the content type and include the content itself or provide a URL to extract the content from an external source.
        It will combine the attributes and preferences of the user and the information.

        There are two main types of gadget content, which are distinguished by the type attribute of the <Content> element.


        - URL: include content from a remote site, but do not have full access to the characteristics of the container.
               This type of gadget supports compatibility with existing legacy iGoogle gadgets, but it is considered obsolete and should be avoided when creating new gadgets.

             - HTML: include content directly within the <Content> element. This includes the HTML, CSS and JavaScript code that the container will represent in the iframe of the gadget.
              This content must be included in a CDATA section to prevent the gadget's parser from interpreting the HTML markup embedded as XML.

        Gadgets can define multiple sections of content, each with a different view.
        The views supported by the Atlassian containers are predetermined for the standard view of a gadget on a page along with other gadgets and content,
        and canvas for the maximized view of a single gadget on a page by itself. Other containers can support additional view types.
        If the same content section should be displayed in more than one view, you can specify multiple views, separated by commas.

        href="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/html/jira-gadget-qrapids-plugin.html"
    -->

    <Content type="html" view="canvas,profile" >
        <![CDATA[

            #requireResource("com.atlassian.jira.gadgets:common")
            #requireResource("com.atlassian.gadgets.publisher:ajs-gadgets")
            #requireResource("com.atlassian.plugins.qrapids:jira-gadget-qrapids-plugin")
            #requireResource("confluence.web.resources:jquery")
            #requireResource("confluence.web.resources:ajs")
            #requireResource("com.atlassian.auiplugin:ajs")
            #supportedLocales("gadget.common")
            #requireResource("jira.webresources:calendar")
            #includeResources()


            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

            <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.js"></script>
            <script src="https://d3js.org/d3.v5.js"></script>

            <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
            <script src="https://unpkg.com/gijgo@1.9.11/js/gijgo.min.js" type="text/javascript"></script>
            <link href="https://unpkg.com/gijgo@1.9.11/css/gijgo.min.css" rel="stylesheet" type="text/css" />

            <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
            <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>


            <script src="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/js/gaugeChart.js" type="text/javascript"></script>
            <script src="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/js/radarChart.js" type="text/javascript"></script>
            <script src="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/js/lineChart.js" type="text/javascript"></script>
            <script src="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/js/stackedLineChart.js" type="text/javascript"></script>
            <script src="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/js/scriptDatePicker.js" type="text/javascript"></script>
            <script src="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/js/jira-gadget-qrapids-plugin.js" type="text/javascript"></script>
            <link href="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/css/jira-gadget-qrapids-plugin.css" type="text/css" rel="stylesheet">

            <script type="text/javascript">
                (function() {

                    console.clear();

                    var viewItemText = ["Graphical","Table","Current","Historical"];
                    var currentProject = "default";
                    var from = '2019-01-01';
                    var to = getToday();

                    var dataCurrentSI = [];
                    var dataHistoricalSI  = [];
                    var fromSI = from;
                    var toSI = to;

                    var dataCurrentDSI  = [];
                    var dataHistoricalDSI  = [];
                    var fromDSI = from;
                    var toDSI = to;

                    var dataCurrentQF  = [];
                    var dataHistoricalQF  = [];
                    var fromQF = from;
                    var toQF = to;

                    var dataCurrentM  = [];
                    var dataHistoricalM  = [];
                    var fromM = from;
                    var toM = to;

                    var dataQR  = [];

                    var listProjects = [];

                    function buildDivView(prj) {

                        var nav = document.getElementById("id_TopNav");
                        var content = document.getElementById("id_TabContent");

                        if (nav != null && content != null) {
                            nav.remove();
                            content.remove();
                        }

                        var divView = document.getElementsByClassName('view');

                        //TopNav
                        var div_TopNav = document.createElement('div');
                        div_TopNav.setAttribute("class", "topnav");
                        div_TopNav.setAttribute("id","id_TopNav");

                        //Dropdown menu
                        var spanPosition = document.createElement('span');
                        spanPosition.setAttribute("class", "span-position");

                        var divDropdown = document.createElement('div');
                        divDropdown.setAttribute("class", "dropdown");

                        var buttonDropdown = document.createElement('button');
                        buttonDropdown.setAttribute("type","button");
                        buttonDropdown.setAttribute("class","btn btn-default dropdown-toggle margin-button-nav");
                        buttonDropdown.setAttribute("data-toggle","dropdown");
                        buttonDropdown.setAttribute("aria-haspopup","true");
                        buttonDropdown.setAttribute("aria-expanded","false");

                        var imageDropdown = document.createElement('img');
                        imageDropdown.setAttribute("src","__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/images/view-mode.png");
                        buttonDropdown.appendChild(imageDropdown);

                        var ulDropdown = document.createElement('ul');
                        ulDropdown.setAttribute("class","dropdown-menu");

                        for (i = 0; i < viewItemText.length; ++i) {
                            var id = "id_" + viewItemText[i];
                            var liDropdown = document.createElement('li');
                            var aLi = document.createElement('a');
                            aLi.setAttribute("id",id);
                            if (i == 0 ||i == 2) aLi.setAttribute("class", "active");
                            var imgLi = document.createElement('img');
                            imgLi.setAttribute("class","icons-view-mode");
                            if (viewItemText[i] == "Graphical") {
                                imgLi.setAttribute("src","__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/images/graphical.png");
                                imgLi.setAttribute("alt","graphical data");
                            }
                            else if (viewItemText[i] == "Table") {
                                imgLi.setAttribute("src","__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/images/table.png");
                                imgLi.setAttribute("alt","table data");
                            }
                            else if (viewItemText[i] == "Current") {
                                imgLi.setAttribute("src","__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/images/current.png");
                                imgLi.setAttribute("alt","current data");
                            }
                            else if (viewItemText[i] == "Historical") {
                                imgLi.setAttribute("src","__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/images/historical.png");
                                imgLi.setAttribute("alt","historical data");
                            }

                            aLi.appendChild(imgLi);
                            aLi.append(viewItemText[i]);
                            liDropdown.appendChild(aLi);
                            ulDropdown.appendChild(liDropdown);
                            if (i == 1) {
                                var liSeparator = document.createElement('li');
                                liSeparator.setAttribute("role","separator");
                                liSeparator.setAttribute("class","divider");
                                ulDropdown.appendChild(liSeparator);
                            }
                        }

                        divDropdown.appendChild(buttonDropdown);
                        divDropdown.appendChild(ulDropdown);
                        spanPosition.appendChild(divDropdown);
                        div_TopNav.appendChild(spanPosition);

                        //Tab SI
                        var tab = document.createElement('a');
                        tab.setAttribute("id","id_tab_si");
                        tab.setAttribute("class","tab-nav active");
                        tab.setAttribute("data-toggle","tab");
                        tab.setAttribute("href","#si");
                        tab.setAttribute("style","margin-left: 50px;");
                        var text = document.createTextNode("Strategic Indicators");
                        tab.appendChild(text);
                        div_TopNav.appendChild(tab);

                        //Tab DSI
                        tab = document.createElement('a');
                        tab.setAttribute("id","id_tab_dsi");
                        tab.setAttribute("class","tab-nav");
                        tab.setAttribute("data-toggle","tab");
                        tab.setAttribute("href","#dsi");
                        text = document.createTextNode("Detailed Strategic Indicators");
                        tab.appendChild(text);
                        div_TopNav.appendChild(tab);

                        //Tab QF
                        tab = document.createElement('a');
                        tab.setAttribute("id","id_tab_qf");
                        tab.setAttribute("class","tab-nav");
                        tab.setAttribute("data-toggle","tab");
                        tab.setAttribute("href","#qf");
                        text = document.createTextNode("Quality Factors");
                        tab.appendChild(text);
                        div_TopNav.appendChild(tab);

                        //Tab M
                        tab = document.createElement('a');
                        tab.setAttribute("id","id_tab_m");
                        tab.setAttribute("class","tab-nav");
                        tab.setAttribute("data-toggle","tab");
                        tab.setAttribute("href","#m");
                        text = document.createTextNode("Metrics");
                        tab.appendChild(text);
                        div_TopNav.appendChild(tab);

                        //Tab QR
                        tab = document.createElement('a');
                        tab.setAttribute("id","id_tab_qr");
                        tab.setAttribute("class","tab-nav");
                        tab.setAttribute("data-toggle","tab");
                        tab.setAttribute("href","#qr");
                        text = document.createTextNode("QR");
                        tab.appendChild(text);
                        div_TopNav.appendChild(tab);

                        //Tab Project
                        tab = document.createElement('span');
                        tab.setAttribute("id","id_tab_project");
                        tab.setAttribute("class","current-project-style navbar-text");
                        tab.append(prj);
                        div_TopNav.appendChild(tab);

                        //TabContent
                        var div_TabContent = document.createElement('div');
                        div_TabContent.setAttribute("class", "tab-content clearfix");
                        div_TabContent.setAttribute("id","id_TabContent");

                        //Div SI
                        var divTab = document.createElement('div');
                        divTab.setAttribute("class","tab-pane active");
                        divTab.setAttribute("id","si");
                        div_TabContent.appendChild(divTab);

                        //Div DSI
                        divTab = document.createElement('div');
                        divTab.setAttribute("class","tab-pane");
                        divTab.setAttribute("id","dsi");
                        div_TabContent.appendChild(divTab);

                        //Div QF
                        divTab = document.createElement('div');
                        divTab.setAttribute("class","tab-pane");
                        divTab.setAttribute("id","qf");
                        div_TabContent.appendChild(divTab);

                        //Div M
                        divTab = document.createElement('div');
                        divTab.setAttribute("class","tab-pane");
                        divTab.setAttribute("id","m");
                        div_TabContent.appendChild(divTab);

                        //Div QR
                        divTab = document.createElement('div');
                        divTab.setAttribute("class","tab-pane");
                        divTab.setAttribute("id","qr");
                        div_TabContent.appendChild(divTab);

                        divView.item(0).append(div_TopNav);
                        divView.item(0).append(div_TabContent);

                    }

                    //  AJS (Atlassian JavaScipt)
                    var gadgetQRAPID = AJS.Gadget({
                        baseUrl: "__ATLASSIAN_BASE_URL__",
                        useOauth: "/rest/gadget/1.0/currentUser",
                        config: {
                           descriptor: function(args) {
                               var gadget = this;
                               console.log(" \\\\\\\\\\\\\\ gadget-config ///////////// ");

                               return {
                                    action: "/rest/gadget/1.0/currentUser",
                                    theme : function () {
                                        if (gadgets.window.getViewportDimensions().width < 450) {
                                            return "gdt top-label sol";
                                        } else {
                                           return "gdt";
                                        }
                                    }(),
                                    fields: [
                                        {
                                            userpref: "urlDashboardApiCallsPref",
                                            label: gadget.getMsg("gadget.common.display.text.label"),
                                            description: gadget.getMsg("gadget.common.display.text.description"),
                                            type: "textArea",
                                            value: gadget.getPref("urlDashboardApiCallsPref")
                                        },
                                        {
                                            userpref: "selectProjectUserPref",
                                            label: gadget.getMsg("gadget.common.cumulative.label"),
                                            description: gadget.getMsg("gadget.common.cumulative.description"),
                                            type: "select",
                                            selected: gadget.getPref("selectProjectUserPref"),
                                            options: listProjects
                                        },

                                        AJS.gadget.fields.nowConfigured()

                                   ]
                               };
                           }
                        },
                        view: {
                            enableReload: false,
                            onResizeReload: false,
                            onResizeAdjustHeight: true,
                            template: function(args) {

                                var error = document.getElementById("ag-sys-msg");
                                if (error != null || error != " ")
                                    error.style.display = null;

                                var gadget = this;
                                console.log(" \\\\\\\\\\\\\\ gadget-view ///////////// ");
                                console.log(args);

                                if (listProjects.length == 0)
                                    args.projects.forEach(function(item) {
                                        var currentItem = {label: item, value: item};
                                        listProjects.push(currentItem);
                                    });

                                // First time to show currentProject
                                if ($('#id_tab_project').length == 0) {
                                    if (currentProject != gadget.getPref("selectProjectUserPref") && gadget.getPref("selectProjectUserPref") != "")
                                        currentProject = gadget.getPref("selectProjectUserPref");
                                    gadget.savePref("selectProjectUserPref",currentProject);
                                }
                                // New currentProject selected to show
                                else {
                                    if (currentProject != gadget.getPref("selectProjectUserPref") && gadget.getPref("selectProjectUserPref") != "") {
                                        currentProject = gadget.getPref("selectProjectUserPref");
                                        document.getElementById("id_tab_project").innerHTML = currentProject;
                                        $("#id_Table").removeClass('active');
                                        $("#id_Historical").removeClass('active');
                                        $('#id_Graphical').addClass('active');
                                        $('#id_Current').addClass('active');
                                        fromSI = from;
                                        toSI = to;
                                        fromDSI = from;
                                        toDSI = to;
                                        fromQF = from;
                                        toQF = to;
                                        fromM = from;
                                        toM = to;
                                        gadget.savePref("selectProjectUserPref",currentProject);
                                    }
                                }
                                buildDivView(currentProject);

                                dataCurrentSI = args.dtoCSI;
                                dataHistoricalSI  = args.dtoHSI;

                                dataCurrentDSI  = args.dtoCDSI;
                                dataHistoricalDSI  = args.dtoHDSI;

                                dataCurrentQF  = args.dtoCQF;
                                dataHistoricalQF  = args.dtoHQF;

                                dataCurrentM = args.dtoCM;
                                dataHistoricalM  = args.dtoHM;

                                dataQR = args.dtoQR;

                                if (!$("#id_tab_si").hasClass('active') && !$('#si').hasClass('active')) {
                                    $(".tab-nav").removeClass('active');
                                    $(".tab-pane").removeClass('active')
                                    $('#id_tab_si').addClass('active');
                                    $('#si').addClass('active');
                                }
                                printCurrentChartSI(dataCurrentSI);

                                // Tabs

                                $('#id_tab_si').on('click', function(){
                                    $(".tab-nav").removeClass('active');
                                    $('#id_tab_si').addClass('active');

                                    if ($('#id_Graphical').hasClass('active') && $('#id_Current').hasClass('active')) printCurrentChartSI(dataCurrentSI);
                                    else if ($('#id_Graphical').hasClass('active') && $('#id_Historical').hasClass('active')) printHistoricalChartSI(dataHistoricalSI, fromSI, toSI);
                                    else if ($('#id_Table').hasClass('active') && $('#id_Current').hasClass('active')) printCurrentTableSI(dataCurrentSI);
                                    else if ($('#id_Table').hasClass('active') && $('#id_Historical').hasClass('active')) printHistoricalTableSI(dataHistoricalSI, fromSI, toSI);
                                });

                                $('#id_tab_dsi').on('click', function(){
                                    $(".tab-nav").removeClass('active');
                                    $('#id_tab_dsi').addClass('active');

                                    if ($('#id_Graphical').hasClass('active') && $('#id_Current').hasClass('active')) printCurrentChartDSI(dataCurrentDSI);
                                    else if ($('#id_Graphical').hasClass('active') && $('#id_Historical').hasClass('active')) printHistoricalChartDSI(dataHistoricalDSI, fromDSI, toDSI);
                                    else if ($('#id_Table').hasClass('active') && $('#id_Current').hasClass('active')) printCurrentTableDSI(dataCurrentDSI);
                                    else if ($('#id_Table').hasClass('active') && $('#id_Historical').hasClass('active')) printHistoricalTableDSI(dataHistoricalDSI, fromDSI, toDSI);
                                });

                                $('#id_tab_qf').on('click', function(){
                                    $(".tab-nav").removeClass('active');
                                    $('#id_tab_qf').addClass('active');

                                    if ($('#id_Graphical').hasClass('active') && $('#id_Current').hasClass('active')) printCurrentChartQF(dataCurrentQF);
                                    else if ($('#id_Graphical').hasClass('active') && $('#id_Historical').hasClass('active')) printHistoricalChartQF(dataHistoricalQF, fromQF, toQF);
                                    else if ($('#id_Table').hasClass('active') && $('#id_Current').hasClass('active')) printCurrentTableQF(dataCurrentQF);
                                    else if ($('#id_Table').hasClass('active') && $('#id_Historical').hasClass('active')) printHistoricalTableQF(dataHistoricalQF, fromQF, toQF);
                                });

                                $('#id_tab_m').on('click', function(){
                                    $(".tab-nav").removeClass('active');
                                    $('#id_tab_m').addClass('active');

                                    if ($('#id_Graphical').hasClass('active') && $('#id_Current').hasClass('active')) printCurrentChartM(dataCurrentM);
                                    else if ($('#id_Graphical').hasClass('active') && $('#id_Historical').hasClass('active')) printHistoricalChartM(dataHistoricalM, fromM, toM);
                                    else if ($('#id_Table').hasClass('active') && $('#id_Current').hasClass('active')) printCurrentTableM(dataCurrentM);
                                    else if ($('#id_Table').hasClass('active') && $('#id_Historical').hasClass('active')) printHistoricalTableM(dataHistoricalM, fromM, toM);
                                });

                                $('#id_tab_qr').on('click', function(){
                                    $(".tab-nav").removeClass('active');
                                    $('#id_tab_qr').addClass('active');

                                    var dtoIssues = [];
                                    AJS.$.ajax({
                                        url: AJS.contextPath() + "/rest/qrapids-gadget/1.0/Issues"+ "/prj=" + currentProject +".json",
                                        type: 'get',
                                        dataType: 'json',
                                        async: false,
                                        success: function(data){
                                           dtoIssues = data;
                                        }
                                    });
                                    printTableQR(dataQR, dtoIssues, "__ATLASSIAN_BASE_URL__");
                                });

                                // Menus Items Dropdown

                                // G
                                $('#id_Graphical').on('click', function(){
                                    $("#id_Table").removeClass('active');
                                    $('#id_Graphical').addClass('active');

                                    // -> R
                                    if ($('#id_Current').hasClass('active')) {
                                        console.log(" ________________________ G -> C ________________________ ");
                                        if ($('#id_tab_si').hasClass('active')) printCurrentChartSI(dataCurrentSI);
                                        else if ($('#id_tab_dsi').hasClass('active')) printCurrentChartDSI(dataCurrentDSI);
                                        else if ($('#id_tab_qf').hasClass('active')) printCurrentChartQF(dataCurrentQF);
                                        else if ($('#id_tab_m').hasClass('active')) printCurrentChartM(dataCurrentM);
                                    }
                                    // -> H
                                    else {
                                        console.log(" ________________________ G -> H ________________________ ");
                                        if ($('#id_tab_si').hasClass('active')) printHistoricalChartSI(dataHistoricalSI, fromSI, toSI);
                                        else if ($('#id_tab_dsi').hasClass('active')) printHistoricalChartDSI(dataHistoricalDSI, fromDSI, toDSI);
                                        else if ($('#id_tab_qf').hasClass('active')) printHistoricalChartQF(dataHistoricalQF, fromQF, toQF);
                                        else if ($('#id_tab_m').hasClass('active')) printHistoricalChartM(dataHistoricalM, fromM, toM);
                                    }
                                });

                                // T
                                $('#id_Table').on('click', function(){
                                    $("#id_Graphical").removeClass('active');
                                    $('#id_Table').addClass('active');

                                    // -> R
                                    if ($('#id_Current').hasClass('active')) {
                                        console.log(" ________________________ T -> C ________________________ ");
                                        if ($('#id_tab_si').hasClass('active')) printCurrentTableSI(dataCurrentSI);
                                        else if ($('#id_tab_dsi').hasClass('active')) printCurrentTableDSI(dataCurrentDSI);
                                        else if ($('#id_tab_qf').hasClass('active')) printCurrentTableQF(dataCurrentQF);
                                        else if ($('#id_tab_m').hasClass('active')) printCurrentTableM(dataCurrentM);
                                    }

                                    // -> H
                                    else {
                                        console.log(" ________________________ T -> H ________________________ ");
                                        if ($('#id_tab_si').hasClass('active')) printHistoricalTableSI(dataHistoricalSI, fromSI, toSI);
                                        else if ($('#id_tab_dsi').hasClass('active')) printHistoricalTableDSI(dataHistoricalDSI, fromDSI, toDSI);
                                        else if ($('#id_tab_qf').hasClass('active')) printHistoricalTableQF(dataHistoricalQF, fromQF, toQF);
                                        else if ($('#id_tab_m').hasClass('active')) printHistoricalTableM(dataHistoricalM, fromM, toM);
                                    }
                                });

                                // R
                                $('#id_Current').on('click', function(){
                                    $("#id_Historical").removeClass('active');
                                    $('#id_Current').addClass('active');

                                    // G
                                    if ($('#id_Graphical').hasClass('active')) {
                                        console.log(" ________________________ G <- C ________________________ ");
                                        if ($('#id_tab_si').hasClass('active')) printCurrentChartSI(dataCurrentSI);
                                        else if ($('#id_tab_dsi').hasClass('active')) printCurrentChartDSI(dataCurrentDSI);
                                        else if ($('#id_tab_qf').hasClass('active')) printCurrentChartQF(dataCurrentQF);
                                        else if ($('#id_tab_m').hasClass('active')) printCurrentChartM(dataCurrentM);
                                    }

                                    // T
                                    else {
                                        console.log(" ________________________ T <- C ________________________ ");
                                        if ($('#id_tab_si').hasClass('active')) printCurrentTableSI(dataCurrentSI);
                                        else if ($('#id_tab_dsi').hasClass('active')) printCurrentTableDSI(dataCurrentDSI);
                                        else if ($('#id_tab_qf').hasClass('active')) printCurrentTableQF(dataCurrentQF);
                                        else if ($('#id_tab_m').hasClass('active')) printCurrentTableM(dataCurrentM);
                                    }
                                });

                                // H
                                $('#id_Historical').on('click', function(){
                                    $("#id_Current").removeClass('active');
                                    $('#id_Historical').addClass('active');

                                    // G
                                    if ($('#id_Graphical').hasClass('active')) {
                                        console.log(" ________________________ G <- H ________________________ ");
                                        if ($('#id_tab_si').hasClass('active')) printHistoricalChartSI(dataHistoricalSI, fromSI, toSI);
                                        else if ($('#id_tab_dsi').hasClass('active')) printHistoricalChartDSI(dataHistoricalDSI, fromDSI, toDSI);
                                        else if ($('#id_tab_qf').hasClass('active')) printHistoricalChartQF(dataHistoricalQF, fromQF, toQF);
                                        else if ($('#id_tab_m').hasClass('active')) printHistoricalChartM(dataHistoricalM, fromM, toM);
                                    }

                                    // T
                                    else {
                                        console.log(" ________________________ T <- H ________________________ ");
                                        if ($('#id_tab_si').hasClass('active')) printHistoricalTableSI(dataHistoricalSI, fromSI, toSI);
                                        else if ($('#id_tab_dsi').hasClass('active')) printHistoricalTableDSI(dataHistoricalDSI, fromDSI, toDSI);
                                        else if ($('#id_tab_qf').hasClass('active')) printHistoricalTableQF(dataHistoricalQF, fromQF, toQF);
                                        else if ($('#id_tab_m').hasClass('active')) printHistoricalTableM(dataHistoricalM, fromM, toM);
                                    }
                                });

                                // New dates
                                $(document).on('click', '#id_applyDates', function(){
                                    if ($('#id_tab_si').hasClass('active')) {
                                        var newFrom = document.getElementById("id_DatePickerFrom-si").value;
                                        var newTo = document.getElementById("id_DatePickerTo-si").value;
                                        if (isValidDate(newFrom) && isValidDate(newTo) && isFromLesserEqualThanTo(newFrom, newTo)) {
                                            console.log("id_applyDates [SI]--->  " + "newFrom: " + newFrom + ", newTo: " + newTo);
                                            getAllHistoricalDataFromNewDate(newFrom, newTo);
                                        }
                                    }
                                    else if ($('#id_tab_dsi').hasClass('active')) {
                                        var newFrom = document.getElementById("id_DatePickerFrom-dsi").value;
                                        var newTo = document.getElementById("id_DatePickerTo-dsi").value;
                                        if (isValidDate(newFrom) && isValidDate(newTo) && isFromLesserEqualThanTo(newFrom, newTo)) {
                                            console.log("id_applyDates [DSI]--->  " + "newFrom: " + newFrom + ", newTo: " + newTo);
                                            getAllHistoricalDataFromNewDate(newFrom, newTo);
                                        }
                                    }
                                    else if ($('#id_tab_qf').hasClass('active')) {
                                        var newFrom = document.getElementById("id_DatePickerFrom-qf").value;
                                        var newTo = document.getElementById("id_DatePickerTo-qf").value;
                                        if (isValidDate(newFrom) && isValidDate(newTo) && isFromLesserEqualThanTo(newFrom, newTo)) {
                                            console.log("id_applyDates [QF] --->  " + "newFrom: " + newFrom + ", newTo: " + newTo);
                                            getAllHistoricalDataFromNewDate(newFrom, newTo);
                                        }
                                    }
                                    else if ($('#id_tab_m').hasClass('active')) {
                                        var newFrom = document.getElementById("id_DatePickerFrom-m").value;
                                        var newTo = document.getElementById("id_DatePickerTo-m").value;
                                        if (isValidDate(newFrom) && isValidDate(newTo) && isFromLesserEqualThanTo(newFrom, newTo)) {
                                            console.log("id_applyDates [M] --->  " + "newFrom: " + newFrom + ", newTo: " + newTo);
                                            getAllHistoricalDataFromNewDate(newFrom, newTo);
                                        }
                                    }
                                });

                                function getAllHistoricalDataFromNewDate(newFrom, newTo) {
                                    var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                    // SI & Chart
                                    // SI & Table
                                    if ($("#id_tab_si").hasClass('active')) {
                                        fromSI = newFrom;
                                        toSI = newTo;
                                        //Get HSI
                                        AJS.$.ajax({
                                            url: AJS.contextPath() + "/rest/qrapids-gadget/1.0/StrategicIndicators/HistoricalData/url="+ encodedURL + "/prj=" + currentProject + "/from="+ fromSI +"&to="+ toSI +".json",
                                            type: 'get',
                                            dataType: 'json',
                                            async: false,
                                            success: function(data){
                                               dataHistoricalSI = data;
                                            }
                                        });
                                        if ($('#id_Graphical').hasClass('active')) printHistoricalChartSI(dataHistoricalSI, fromSI, toSI);
                                        else printHistoricalTableSI(dataHistoricalSI, fromSI, toSI);
                                    }

                                    //DSI & Chart
                                    //DSI & Table
                                    else if ($("#id_tab_dsi").hasClass('active')) {
                                        //Get HDSI
                                        fromDSI = newFrom;
                                        toDSI = newTo;
                                        AJS.$.ajax({
                                            url: AJS.contextPath() + "/rest/qrapids-gadget/1.0/DetailedStrategicIndicators/HistoricalData/url="+ encodedURL + "/prj=" + currentProject + "/from="+ fromDSI +"&to="+ toDSI +".json",
                                            type: 'get',
                                            dataType: 'json',
                                            async: false,
                                            success: function(data){
                                               dataHistoricalDSI = data;
                                            }
                                        });
                                        if ($('#id_Graphical').hasClass('active')) printHistoricalChartDSI(dataHistoricalDSI, fromDSI, toDSI);
                                        else printHistoricalTableDSI(dataHistoricalDSI, fromDSI, toDSI);
                                    }

                                    //QF & Chart
                                    //QF & Table
                                    else if ($("#id_tab_qf").hasClass('active')) {
                                        //Get HQF
                                        fromQF = newFrom;
                                        toQF = newTo;
                                        AJS.$.ajax({
                                            url: AJS.contextPath() + "/rest/qrapids-gadget/1.0/QualityFactors/HistoricalData/url="+ encodedURL + "/prj=" + currentProject + "/from="+ fromQF +"&to="+ toQF +".json",
                                            type: 'get',
                                            dataType: 'json',
                                            async: false,
                                            success: function(data){
                                               dataHistoricalQF = data;
                                            }
                                        });
                                        if ($('#id_Graphical').hasClass('active')) printHistoricalChartQF(dataHistoricalQF, fromQF, toQF);
                                        else printHistoricalTableQF(dataHistoricalQF, fromQF, toQF);
                                    }

                                    //M & Chart
                                    //M & Table
                                    else if ($("#id_tab_m").hasClass('active')) {
                                        //Get HM
                                        fromM = newFrom;
                                        toM = newTo;
                                        AJS.$.ajax({
                                            url: AJS.contextPath() + "/rest/qrapids-gadget/1.0/Metrics/HistoricalData/url="+ encodedURL + "/prj=" + currentProject + "/from="+ fromM +"&to="+ toM +".json",
                                            type: 'get',
                                            dataType: 'json',
                                            async: false,
                                            success: function(data){
                                               dataHistoricalM = data;
                                            }
                                        });
                                        if ($('#id_Graphical').hasClass('active')) printHistoricalChartM(dataHistoricalM, fromM, toM);
                                        else printHistoricalTableM(dataHistoricalM, fromM, toM);
                                    }
                                }

                            },
                            args: [
                                {
                                    key: "dtoCSI",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        var prj = gadget.getPref("selectProjectUserPref") != "" ? gadget.getPref("selectProjectUserPref") : currentProject;
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/StrategicIndicators/CurrentEvaluation/url="+ encodedURL + "/prj=" + prj +".json"
                                        };
                                    }
                                },
                                {
                                    key: "dtoCDSI",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        var prj = gadget.getPref("selectProjectUserPref") != "" ? gadget.getPref("selectProjectUserPref") : currentProject;
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/DetailedStrategicIndicators/CurrentEvaluation/url="+ encodedURL + "/prj=" + prj +".json"
                                        };
                                    }
                                },
                                {
                                    key: "dtoCQF",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        var prj = gadget.getPref("selectProjectUserPref") != "" ? gadget.getPref("selectProjectUserPref") : currentProject;
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/QualityFactors/CurrentEvaluation/url="+ encodedURL + "/prj=" + prj +".json"
                                        };
                                    }
                                },
                                {
                                    key: "dtoCM",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        var prj = gadget.getPref("selectProjectUserPref") != "" ? gadget.getPref("selectProjectUserPref") : currentProject;
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/Metrics/CurrentEvaluation/url="+ encodedURL + "/prj=" + prj +".json"
                                        };
                                    }
                                },
                                {
                                    key: "dtoHSI",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        var prj = gadget.getPref("selectProjectUserPref") != "" ? gadget.getPref("selectProjectUserPref") : currentProject;
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/StrategicIndicators/HistoricalData/url="+ encodedURL + "/prj=" + prj + "/from="+ from +"&to="+ to +".json"
                                        };
                                    }
                                },
                                {
                                    key: "dtoHDSI",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        var prj = gadget.getPref("selectProjectUserPref") != "" ? gadget.getPref("selectProjectUserPref") : currentProject;
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/DetailedStrategicIndicators/HistoricalData/url="+ encodedURL + "/prj=" + prj + "/from="+ from +"&to="+ to +".json"
                                        };
                                    }
                                },
                                {
                                    key: "dtoHQF",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        var prj = gadget.getPref("selectProjectUserPref") != "" ? gadget.getPref("selectProjectUserPref") : currentProject;
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/QualityFactors/HistoricalData/url="+ encodedURL + "/prj=" + prj + "/from="+ from +"&to="+ to +".json"
                                        };
                                    }
                                },
                                {
                                    key: "dtoHM",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        var prj = gadget.getPref("selectProjectUserPref") != "" ? gadget.getPref("selectProjectUserPref") : currentProject;
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/Metrics/HistoricalData/url="+ encodedURL + "/prj=" + prj + "/from="+ from +"&to="+ to +".json"
                                        };
                                    }
                                },
                                {
                                    key: "dtoQR",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        var prj = gadget.getPref("selectProjectUserPref") != "" ? gadget.getPref("selectProjectUserPref") : currentProject;
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/QualityRequirements/Alerts/url="+ encodedURL + "/prj=" + prj + ".json"
                                        };
                                    }
                                },
                                {
                                    key: "projects",
                                    ajaxOptions: function() {
                                        var gadget = this;
                                        var encodedURL = window.btoa(gadget.getPref("urlDashboardApiCallsPref"));
                                        return {
                                            url: "/rest/qrapids-gadget/1.0/Projects/AssessedProjects/url="+ encodedURL + ".json"
                                        };
                                    }
                                }
                            ]
                        }
                    });
                })();

            </script>
        ]]>
    </Content>
</Module>