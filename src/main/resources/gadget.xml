<?xml version="1.0" encoding="UTF-8" ?>
<Module>

    <!-- Especifiaciones del Gadget (nombre, autor, ) -->
    <!-- screenshot: direccion de la imagen que un container o directory pueden usar para ilustrar el gadget -->
    <!-- thumbnail: direccion de la imagen en miniatura (120x60 px) que un container o directory pueden usar para ilustrar el gadget-->

    <ModulePrefs title="__MSG_gadget.title__"
                 directory_title="__MSG_gadget.title__"
                 description="__MSG_gadget.description__"
                 author="Surname Name"
                 author_email="author@email.com"
                 screenshot="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/images/qrapids_logo.png"
                 thumbnail="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/images/qrapids_logo.png">

        <!-- El elemento indica al container que el gadget puede utilizar una función específica -->
        <Optional feature="gadget-directory">
            <!-- Permite suministrar parametros para las funciones solicitadas a traves de los elementos -->
            <Param name="categories">
                JIRA
                Charts
                QRapids
            </Param>
        </Optional>
        <Optional feature="atlassian.util" />
        <Optional feature="auth-refresh" />

        <!-- El elemento indica al container que el gadget necesita un caracteristica especifica (librerias) -->
        <Require feature="views" />
        <Require feature="settitle"/>
        <Require feature="oauthpopup" />
        <Require feature="opensocial-0.8" />

        #oauth
        <Locale messages="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/i18n/ALL_ALL.xml"/>
    </ModulePrefs>

    <!--
    Esta sección le permite a los usuarios una forma de proporcionar sus preferencias "preferencias del usuario".
    Estos campos de entrada del usuario se convierten en controles de interfaz de usuario cuando se ejecuta el gadget.
    Cuando se muestra el gadget en iGoogle, se puede acceder a las preferencias del usuario desde el menú desplegable "Editar".

    El contenedor maneja la generación de la IU de configuración, guarda la configuración y proporciona una API para acceder a la configuración en JavaScript.
    -->
    <UserPref name="show_date" display_name="Show Dates?" datatype="bool" default_value="true"/>
    <UserPref name="show_summ" display_name="Show Summaries?" datatype="bool" default_value="true"/>
    <UserPref name="num_entries" display_name="Number of Entries:" default_value="5"/>
    <UserPref name="selectedTab" datatype="hidden"/>

    <!--
    En esta sección, definirá el tipo de contenido, e incluirá el contenido en sí mismo o proporcionará una URL para extraer el contenido de una fuente externa.
    Combinará los atributos y las preferencias del usuario y la información.

    Hay dos tipos principales de contenido de gadget, que se distinguen por el atributo type del elemento <Content>.

    - URL: incluyen contenido de un sitio remoto, pero no tienen acceso completo a las características del contenedor.
           Este tipo de gadget es compatible con la compatibilidad con los gadgets de iGoogle heredados existentes,
           pero se considera obsoleto y debe evitarse al crear nuevos gadgets.

    - HTML: incluyen el contenido directamente dentro del elemento <Content>. Esto incluye el codigo HTML, CSS y JavaScript que el contenedor representará en el iframe del gadget.
     Este contenido debe incluirse en una sección CDATA para evitar que el analizador de especificaciones del gadget interprete el marcado HTML incrustado como XML.

    Los gadgets pueden definir múltiples secciones de contenido, cada una con una vista diferente.
    Las vistas admitidas por los contenedores de Atlassian son predeterminadas para la vista estándar de un gadget en una página junto con otros gadgets y contenido,
    y canvas para la vista maximizada de un solo gadget en una página por sí solo. Otros contenedores pueden admitir tipos de vista adicionales.
    Si la misma sección de contenido debe mostrarse en más de una vista, puede especificar varias vistas, separadas por comas.
    -->

    <Content type="html" view="canvas,profile">
        <![CDATA[
        #requireResource("com.atlassian.jira.gadgets:common")
        #requireResource("com.atlassian.gadgets.publisher:ajs-gadgets")
        #requireResource("com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin:jira-gadget-qrapids-plugin")
        #includeResources()


        <script src="__ATLASSIAN_BASE_URL__/download/resources/com.atlassian.plugins.qrapids.jira-gadget-qrapids-plugin/js/jira-gadget-qrapids-plugin.js" type="text/javascript" charset="utf-8"></script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

        <style type="text/css">
            .navbar {
                overflow: hidden;
                background-color: #0177a6;
                top: 0;
                margin: 5px;
                border-radius: 4px 4px 4px 4px ;
                min-height: 0px
             }

            .navbar a {
                float: left;
                display: block;
                color: #f2f2f2;
                text-align: center;
                padding: 10px;
                text-decoration: none;
                font-size: 12px;
            }

            .navbar a:hover {
                background: #ddd;
                color: black;
            }


            .tab-content {
                padding: 5px;
                height: 1500px; /* Used in this example to enable scrolling */
            }


        </style>

        <script type="text/javascript">
        (function () {
            // Initialize tabs, designate the tab named "StrategicIndicators" as
            // the tab selected by default.
            //var tabs = new gadgets.TabSet(__MODULE_ID__, "Strategic Indicators");
            init();


            function getMessage(){
                var gadget_message = AJS.Gadget({

                    baseUrl: "__ATLASSIAN_BASE_URL__",
                    useOauth: "/rest/gadget/1.0/currentUser",
                    view: {
                        template: function(args) {
                            var gadget = this;

                            var messageResponse = args;

                            console.log("**********************MESSAGE***************************");
                            console.log(args.value);

                            var html = "";
                            html += "<p>" + args.value + "</p>";
                            document.getElementById('id_message').innerHTML = html;

                            //gadget.getView().html(messageResponse);
                        },
                        args: [{
                            key: "value",
                            ajaxOptions: function() {
                                return {
                                    url: "/rest/qrapids-gadget/1.0/message.json"
                                };
                            }
                        }]
                    }
                });
            }

            function getProjectData(){
                var projects = AJS.Gadget({

                    baseUrl: "__ATLASSIAN_BASE_URL__",
                    useOauth: "/rest/gadget/1.0/currentUser",
                    view: {
                        template: function(args) {
                            var gadget = this;

                            var projectList = AJS.$("<ul/>");

                            AJS.$(args.projectData.projects).each(function() {
                                projectList.append(
                                    AJS.$("<li/>").append(
                                        AJS.$("<a/>").attr({
                                            target: "_parent",
                                            title: gadgets.util.escapeString(this.key),
                                            href: "__ATLASSIAN_BASE_URL__" + "/browse/" + this.key
                                        }).text(this.name)
                                    )
                                );
                            });

                            //gadget.getView().html(projectList);

                            document.getElementById('id_message').innerHTML = projectList.text();

                            console.log("*********************PROJECTS****************************");
                            console.log(args.projectData);

                        },
                        args: [{
                            key: "projectData",
                            ajaxOptions: function() {
                                return {
                                    url: "/rest/qrapids-gadget/1.0/projects.json"
                                };
                            }
                        }]
                    }
                });
            }

            function getStrategicIndicators(){

                var gadget_strategic_indicators = AJS.Gadget({
                    baseUrl: "__ATLASSIAN_BASE_URL__",
                    useOauth: "/rest/gadget/1.0/currentUser",
                    view: {
                        template: function(args) {
                            var gadget = this;
                            console.log(args);

                            var dtoSIE = args.dtoSIE;

                            console.log("**********************DTOSIE***************************");
                            console.log(args.dtoSIE);

                            var html = "";
                            html += "<p>" + args.dtoSIE + "</p>";
                            document.getElementById('id_message').innerHTML = html;

                            //gadget.getView().html(messageResponse);
                        },
                        args: [{
                            key: "dtoSIE",
                            ajaxOptions: function() {
                                return {
                                    url: "/rest/qrapids-gadget/1.0/strategicindicators/currentevaluation.json"
                                };
                            }
                        }]
                    }
                });
            }

            function init() {
                // Tab Strategic Indicators
                //tabs.addTab("Strategic Indicators", {contentContainer: document.getElementById('id_message'), callback: getStrategicIndicators});
                // Tab Detailed Strategic Indicators
                //tabs.addTab("Detailed Strategic Indicators", {contentContainer: document.getElementById('id_message'), callback: getMessage});
                // Tab Quality Factors
                //tabs.addTab("Quality Factors", {contentContainer: document.getElementById('id_message'), callback: getMessage});
                // Tab Metrics
                //tabs.addTab("Metrics", {contentContainer: document.getElementById('id_message'), callback: getProjectData});
            }

            // Call init function to initialize and display tabs.
            //gadgets.util.registerOnLoadHandler(init);

        })();
        </script>

        <div class="navbar">
            <a href="#si" data-toggle="tab">Strategic Indicators</a>
            <a href="#dsi" data-toggle="tab">Detailed Strategic Indicators</a>
            <a href="#qf" data-toggle="tab">Quality Factors</a>
            <a href="#m" data-toggle="tab">Metrics</a>
        </div>

        <div class="tab-content clearfix">
            <div class="tab-pane active" id="si">
                <h3>Strategic Indicators</h3>
            </div>
            <div class="tab-pane" id="dsi">
                 <h3>Detailed Strategic Indicators</h3>
            </div>
            <div class="tab-pane" id="qf">
                <h3>Quality Factors</h3>
			</div>
            <div class="tab-pane" id="m">
                <h3>Metrics</h3>
			</div>
        </div>

        <div id="debug_div" style="font-size:9pt; padding:5px; color: red;"></div>

        ]]>
    </Content>
</Module>